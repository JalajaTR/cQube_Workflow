[
    {
        "diksha_tpd_district_wise": "select a.*,round(coalesce(sum(sde.total_enrolled),0)*100/nullif(sum(sde.total_teachers),0),1) as percentage_teachers from (select district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by district_id,district_name,collection_id,collection_name union select district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select (now()::Date)) group by district_id,district_name,collection_id,collection_name union select district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select (now()::Date)) group by district_id,district_name,collection_id,collection_name union select district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'All' as time_range from diksha_tpd_agg group by district_id,district_name,collection_id,collection_name)as a left join school_diksha_enrolled as sde on a.district_id=sde.district_id and a.collection_id=sde.collection_id and a.time_range=sde.time_range group by a.district_id,a.district_name,a.collection_id,a.collection_name,a.collection_progress,a.time_range"
    },
    {
        "diksha_tpd_block_wise": "select a.*,round(coalesce(sum(sde.total_enrolled),0)*100/nullif(sum(sde.total_teachers),0),1) as percentage_teachers from (select block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by block_id,block_name,district_id,district_name,collection_id,collection_name union select block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select (now()::Date)) group by block_id,block_name,district_id,district_name,collection_id,collection_name union select block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select (now()::Date)) group by block_id,block_name,district_id,district_name,collection_id,collection_name union select block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'All' as time_range from diksha_tpd_agg group by block_id,block_name,district_id,district_name,collection_id,collection_name)as a left join school_diksha_enrolled as sde on a.block_id=sde.block_id and a.collection_id=sde.collection_id and a.time_range=sde.time_range group by a.district_id,a.district_name,a.block_id,a.block_name,a.collection_id,a.collection_name,a.collection_progress,a.time_range"
    },
    {
        "diksha_tpd_cluster_wise": "select a.*,round(coalesce(sum(sde.total_enrolled),0)*100/nullif(sum(sde.total_teachers),0),1) as percentage_teachers from (select cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select (now()::Date)) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select (now()::Date)) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'All' as time_range from diksha_tpd_agg group by cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name)as a left join school_diksha_enrolled as sde on a.cluster_id=sde.cluster_id and a.collection_id=sde.collection_id and a.time_range=sde.time_range group by a.district_id,a.district_name,a.block_id,a.block_name,a.cluster_id,a.cluster_name,a.collection_id,a.collection_name,a.collection_progress,a.time_range"
    },
    {
        "diksha_tpd_school_wise": "select a.*,round(coalesce(sum(sde.total_enrolled),0)*100/Nullif(sum(sde.total_teachers),0),1) as percentage_teachers from (select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select (now()::Date)) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select (now()::Date)) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,round(cast(avg(collection_progress) as numeric),1) as collection_progress,'All' as time_range from diksha_tpd_agg group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name)as a left join school_diksha_enrolled as sde on a.school_id=sde.school_id and a.collection_id=sde.collection_id and a.time_range=sde.time_range group by a.district_id,a.district_name,a.block_id,a.block_name,a.cluster_id,a.cluster_name,a.school_id,a.school_name,a.collection_id,a.collection_name,a.collection_progress,a.time_range"
    },
    {
        "diksha_tpd_r2_district_overall": "select tr.district_id,initcap(tr.district_name),tr.collection_id,tr.collection_name,'collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,expected_total_enrolled,certificate_percentage,certificate_count ,'All' as time_range from (select exp.district_id ,exp.district as district_name ,  exp.collection_id,exp.collection_name, expected_total_enrolled ,certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage   from (select collection_id ,collection_name,school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select district_id,district,collection_id,collection_name,sum(expected_enrollment) as expected_total_enrolled, sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count from diksha_tpd_expected_enrollment group by district_id,district,collection_id,collection_name) exp on di.collection_id = exp.collection_id and di.district_id = exp.district_id  group by exp.collection_id,exp.collection_name,exp.district_id ,exp.district ,expected_total_enrolled ,certificate_count ) as tr inner join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id and tr.collection_id = diksha_tpd_agg.collection_id   group by tr.district_id,tr.district_name,tr.collection_id,tr.collection_name ,expected_total_enrolled,certificate_percentage,certificate_count union select tr.district_id,initcap(tr.district_name),cast(0 as text)  as collection_id,'all' as collection_name,'all_collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric), 1)as percentage_completion,expected_total_enrolled, certificate_percentage,certificate_count,'All' as time_range from (select di.district_id ,di.district_name, certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage,expected_total_enrolled from (select school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select tr.district_id,sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count,sum(expected_enrollment) as expected_total_enrolled from diksha_tpd_expected_enrollment tr  left join (select distinct district_id,collection_id from diksha_tpd_agg) dpa on tr.district_id = dpa.district_id and tr.collection_id=dpa.collection_id where dpa.collection_id is not NULL group by tr.district_id ) as a on  di.district_id = a.district_id  group by di.district_id ,di.district_name, expected_total_enrolled, certificate_count)tr join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id group by tr.district_id,tr.district_name,expected_total_enrolled,certificate_count, certificate_percentage "
    },
    {
        "diksha_tpd_r2_district_last_90_days": "select tr.district_id,initcap(tr.district_name),tr.collection_id,tr.collection_name,'collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,expected_total_enrolled,certificate_percentage,certificate_count ,'All' as time_range from (select exp.district_id ,exp.district as district_name ,  exp.collection_id,exp.collection_name, expected_total_enrolled ,certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage   from (select collection_id ,collection_name,school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select district_id,district,collection_id,collection_name,sum(expected_enrollment) as expected_total_enrolled, sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count from diksha_tpd_expected_enrollment where batch_end_date is not null and   ((batch_end_date - batch_start_date) < (select now()::DATE - (now() -INTERVAL '90 DAY')::DATE )) group by district_id,district,collection_id,collection_name) exp on di.collection_id = exp.collection_id and di.district_id = exp.district_id  group by exp.collection_id,exp.collection_name,exp.district_id ,exp.district ,expected_total_enrolled ,certificate_count ) as tr inner join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id and tr.collection_id = diksha_tpd_agg.collection_id   group by tr.district_id,tr.district_name,tr.collection_id,tr.collection_name ,expected_total_enrolled,certificate_percentage,certificate_count union select tr.district_id,initcap(tr.district_name),cast(0 as text)  as collection_id,'all' as collection_name,'all_collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric), 1)as percentage_completion,expected_total_enrolled, certificate_percentage,certificate_count,'All' as time_range from (select di.district_id ,di.district_name, certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage,expected_total_enrolled from (select school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select tr.district_id,sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count,sum(expected_enrollment) as expected_total_enrolled from diksha_tpd_expected_enrollment tr  left join (select distinct district_id,collection_id from diksha_tpd_agg) dpa on tr.district_id = dpa.district_id and tr.collection_id=dpa.collection_id where dpa.collection_id is not NULL and  batch_end_date is not null and   ((batch_end_date - batch_start_date) < (select now()::DATE - (now() -INTERVAL '90 DAY')::DATE )) group by tr.district_id ) as a on  di.district_id = a.district_id  group by di.district_id ,di.district_name, expected_total_enrolled, certificate_count)tr join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id group by tr.district_id,tr.district_name,expected_total_enrolled,certificate_count, certificate_percentage "
    },
    {
        "diksha_tpd_r2_district_last_30_days": "select tr.district_id,initcap(tr.district_name),tr.collection_id,tr.collection_name,'collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,expected_total_enrolled,certificate_percentage,certificate_count ,'All' as time_range from (select exp.district_id ,exp.district as district_name ,  exp.collection_id,exp.collection_name, expected_total_enrolled ,certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage   from (select collection_id ,collection_name,school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select district_id,district,collection_id,collection_name,sum(expected_enrollment) as expected_total_enrolled, sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count from diksha_tpd_expected_enrollment where batch_end_date is not null and   ((batch_end_date - batch_start_date) < (select now()::DATE - (now() -INTERVAL '30 DAY')::DATE )) group by district_id,district,collection_id,collection_name) exp on di.collection_id = exp.collection_id and di.district_id = exp.district_id  group by exp.collection_id,exp.collection_name,exp.district_id ,exp.district ,expected_total_enrolled ,certificate_count ) as tr inner join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id and tr.collection_id = diksha_tpd_agg.collection_id   group by tr.district_id,tr.district_name,tr.collection_id,tr.collection_name ,expected_total_enrolled,certificate_percentage,certificate_count union select tr.district_id,initcap(tr.district_name),cast(0 as text)  as collection_id,'all' as collection_name,'all_collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric), 1)as percentage_completion,expected_total_enrolled, certificate_percentage,certificate_count,'All' as time_range from (select di.district_id ,di.district_name, certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage,expected_total_enrolled from (select school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select tr.district_id,sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count,sum(expected_enrollment) as expected_total_enrolled from diksha_tpd_expected_enrollment tr  left join (select distinct district_id,collection_id from diksha_tpd_agg) dpa on tr.district_id = dpa.district_id and tr.collection_id=dpa.collection_id where dpa.collection_id is not NULL and  batch_end_date is not null and   ((batch_end_date - batch_start_date) < (select now()::DATE - (now() -INTERVAL '30 DAY')::DATE )) group by tr.district_id ) as a on  di.district_id = a.district_id  group by di.district_id ,di.district_name, expected_total_enrolled, certificate_count)tr join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id group by tr.district_id,tr.district_name,expected_total_enrolled,certificate_count, certificate_percentage "
    },
    {
        "diksha_tpd_r2_district_last_7_days": "select tr.district_id,initcap(tr.district_name),tr.collection_id,tr.collection_name,'collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,expected_total_enrolled,certificate_percentage,certificate_count ,'All' as time_range from (select exp.district_id ,exp.district as district_name ,  exp.collection_id,exp.collection_name, expected_total_enrolled ,certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage   from (select collection_id ,collection_name,school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select district_id,district,collection_id,collection_name,sum(expected_enrollment) as expected_total_enrolled, sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count from diksha_tpd_expected_enrollment where batch_end_date is not null and   ((batch_end_date - batch_start_date) < (select now()::DATE - (now() -INTERVAL '7 DAY')::DATE )) group by district_id,district,collection_id,collection_name) exp on di.collection_id = exp.collection_id and di.district_id = exp.district_id  group by exp.collection_id,exp.collection_name,exp.district_id ,exp.district ,expected_total_enrolled ,certificate_count ) as tr inner join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id and tr.collection_id = diksha_tpd_agg.collection_id   group by tr.district_id,tr.district_name,tr.collection_id,tr.collection_name ,expected_total_enrolled,certificate_percentage,certificate_count union select tr.district_id,initcap(tr.district_name),cast(0 as text)  as collection_id,'all' as collection_name,'all_collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric), 1)as percentage_completion,expected_total_enrolled, certificate_percentage,certificate_count,'All' as time_range from (select di.district_id ,di.district_name, certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage,expected_total_enrolled from (select school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select tr.district_id,sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count,sum(expected_enrollment) as expected_total_enrolled from diksha_tpd_expected_enrollment tr  left join (select distinct district_id,collection_id from diksha_tpd_agg) dpa on tr.district_id = dpa.district_id and tr.collection_id=dpa.collection_id where dpa.collection_id is not NULL and  batch_end_date is not null and   ((batch_end_date - batch_start_date) < (select now()::DATE - (now() -INTERVAL '7 DAY')::DATE )) group by tr.district_id ) as a on  di.district_id = a.district_id  group by di.district_id ,di.district_name, expected_total_enrolled, certificate_count)tr join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id group by tr.district_id,tr.district_name,expected_total_enrolled,certificate_count, certificate_percentage "
    },
    {
        "diksha_tpd_r2_district_last_day": "select tr.district_id,initcap(tr.district_name),tr.collection_id,tr.collection_name,'collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,expected_total_enrolled,certificate_percentage,certificate_count ,'All' as time_range from (select exp.district_id ,exp.district as district_name ,  exp.collection_id,exp.collection_name, expected_total_enrolled ,certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage   from (select collection_id ,collection_name,school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select district_id,district,collection_id,collection_name,sum(expected_enrollment) as expected_total_enrolled, sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count from diksha_tpd_expected_enrollment where batch_end_date is not null and   ((batch_end_date - batch_start_date) < (select now()::DATE - (now() -INTERVAL '1 DAY')::DATE )) group by district_id,district,collection_id,collection_name) exp on di.collection_id = exp.collection_id and di.district_id = exp.district_id  group by exp.collection_id,exp.collection_name,exp.district_id ,exp.district ,expected_total_enrolled ,certificate_count ) as tr inner join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id and tr.collection_id = diksha_tpd_agg.collection_id   group by tr.district_id,tr.district_name,tr.collection_id,tr.collection_name ,expected_total_enrolled,certificate_percentage,certificate_count union select tr.district_id,initcap(tr.district_name),cast(0 as text)  as collection_id,'all' as collection_name,'all_collections' as type,'district' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled, round(cast(sum(total_enrolled)as numeric)*100.0/cast((expected_total_enrolled)as numeric), 1)as total_enrolled_percentage,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric), 1)as percentage_completion,expected_total_enrolled, certificate_percentage,certificate_count,'All' as time_range from (select di.district_id ,di.district_name, certificate_count,round((((count( certificate_status = 'Issued')) *100)/ (count(*))), 1) as certificate_percentage,expected_total_enrolled from (select school_hierarchy_details.district_id,district_name,certificate_status from diksha_tpd_trans inner join school_hierarchy_details on school_hierarchy_details.school_id = diksha_tpd_trans.school_id) as di inner join ( select tr.district_id,sum(case when is_certificate_available = true then 1 else 0 end) as certificate_count,sum(expected_enrollment) as expected_total_enrolled from diksha_tpd_expected_enrollment tr  left join (select distinct district_id,collection_id from diksha_tpd_agg) dpa on tr.district_id = dpa.district_id and tr.collection_id=dpa.collection_id where dpa.collection_id is not NULL and  batch_end_date is not null and   ((batch_end_date - batch_start_date) < (select now()::DATE - (now() -INTERVAL '1 DAY')::DATE )) group by tr.district_id ) as a on  di.district_id = a.district_id  group by di.district_id ,di.district_name, expected_total_enrolled, certificate_count)tr join  diksha_tpd_agg on  tr.district_id = diksha_tpd_agg.district_id group by tr.district_id,tr.district_name,expected_total_enrolled,certificate_count, certificate_percentage "
    },
    {
        "diksha_tpd_r2_block_last_day": "select block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'block' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by block_id,block_name,district_id,district_name,collection_id,collection_name union select block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'block'as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_block_last_7_days": "select block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'block' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select now()::DATE) group by block_id,block_name,district_id,district_name,collection_id,collection_name union select block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'block' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select now()::DATE) group by block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_block_last_30_days": "select block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'block' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select now()::DATE) group by block_id,block_name,district_id,district_name,collection_id,collection_name union select block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'block' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select now()::DATE) group by block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_block_overall": "select block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'block' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'All' as time_range from diksha_tpd_agg group by block_id,block_name,district_id,district_name,collection_id,collection_name union select block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'block' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'All' as time_range from diksha_tpd_agg  group by block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_cluster_last_day": "select cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'cluster' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select cluster_id,cluster_name,block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'cluster' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_cluster_last_7_days": "select cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'Cluster' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select now()::DATE) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select cluster_id,cluster_name,block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'cluster' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select now()::DATE) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_cluster_last_30_days": "select cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'cluster' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select now()::DATE) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select cluster_id,cluster_name,block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'cluster' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select now()::DATE) group by cluster_id,cluster_name,block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_cluster_overall": "select cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'cluster' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'All' as time_range from diksha_tpd_agg group by cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select cluster_id,cluster_name,block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'cluster' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'All' as time_range from diksha_tpd_agg group by cluster_id,cluster_name,block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_school_last_day": "select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'school 'as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_school_last_7_days": "select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_school_last_30_days": "select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_school_overall": "select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'All' as time_range from diksha_tpd_agg group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name union select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,'0' as collection_id,'All' as collection_name,'all_collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'All' as time_range from diksha_tpd_agg  group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name"
    },
    {
        "diksha_tpd_r2_raw_last_day": "select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'school 'as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_Day' as time_range from diksha_tpd_agg where enrolled_date = (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name"
    },
    {
        "diksha_tpd_r2_raw_last_7_days": "select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_7_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '7 DAY')::Date) and (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name"
    },
    {
        "diksha_tpd_r2_raw_last_30_days": "select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'Last_30_Day' as time_range from diksha_tpd_agg where enrolled_date between (select ((now()::Date)-INTERVAL '30 DAY')::Date) and (select now()::DATE) group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name"
    },
    {
        "diksha_tpd_r2_raw_overall": "select school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name,'collections' as type,'school' as level,sum(total_completed)as total_completed,sum(total_enrolled)as total_enrolled,round(cast(sum(total_completed)as numeric)*100.0/cast(sum(total_enrolled)as numeric),1)as percentage_completion,'All' as time_range from diksha_tpd_agg group by school_id,school_name,cluster_id,cluster_name,block_id,block_name,district_id,district_name,collection_id,collection_name"
    },
    {
        "diksha_tpd_enrolment_progress_all_coll_dist": "select res.collection_id,collection_name,res.district_id,district as district_name,res.dates as date,sum(res.day_wise) over (partition by res.district_id,res.collection_id order by res.dates asc rows between unbounded preceding and current row) as expected_enrollment,sum(res.total_enrolled) over (partition by res.district_id,res.collection_id order by res.dates asc rows unbounded preceding ) as net_enrollment from (select a.collection_id,a.collection_name,a.district_id,a.district,a.dates,sum(day_wise) as day_wise,case when sum(total_enrolled) is not null then sum(total_enrolled) else 0 end as total_enrolled,enrolled_date from (select collection_id,collection_name,district_id,district,batch_id,generate_series(batch_start_date::date,batch_end_date::date, '1 day'::interval)::date as dates from diksha_tpd_expected_enrollment  where batch_end_date is not null ) as a join (select distinct batch_id,collection_id,district_id,expected_enrollment,(batch_end_date::date - batch_start_date::date)+1 as duration,expected_enrollment/COALESCE((batch_end_date::date - batch_start_date::date)+1,1) as day_wise from diksha_tpd_expected_enrollment where batch_end_date is not null ) as b  on  a.batch_id = b.batch_id and a.collection_id=b.collection_id and a.district_id=b.district_id left join (select distinct collection_id,district_id,enrolled_date,sum(total_enrolled) as total_enrolled from diksha_tpd_agg group by collection_id,district_id,enrolled_date,collection_name) as tot_enrol on a.collection_id=tot_enrol.collection_id and a.district_id=tot_enrol.district_id and a.dates=tot_enrol.enrolled_date group by a.collection_id,a.district_id,a.dates,enrolled_date,collection_name,a.district) as res group by res.collection_id,res.district_id,res.dates,res.day_wise,total_enrolled,collection_name,district_name;"
    },
    {
        "diksha_tpd_enrolment_progress_district": "select res.district_id,district as district_name,res.dates as date,sum(res.day_wise) over (partition by res.district_id order by res.dates asc rows between unbounded preceding and current row) as expected_enrollment,sum(res.total_enrolled) over (partition by res.district_id order by res.dates asc rows unbounded preceding ) as net_enrollment from (select a.district_id,a.district,a.dates,sum(day_wise) as day_wise,case when sum(total_enrolled) is not null then sum(total_enrolled) else 0 end as total_enrolled from (select collection_id,district,collection_name,district_id,batch_id,generate_series(batch_start_date::date,batch_end_date::date, '1 day'::interval)::date as dates from diksha_tpd_expected_enrollment  where batch_end_date is not null ) as a join (select distinct batch_id,collection_id,district_id,expected_enrollment,(batch_end_date::date - batch_start_date::date)+1 as duration,expected_enrollment/COALESCE((batch_end_date::date - batch_start_date::date)+1,1) as day_wise from diksha_tpd_expected_enrollment  where batch_end_date is not null ) as b  on  a.batch_id = b.batch_id and a.collection_id=b.collection_id and a.district_id=b.district_id left join (select distinct collection_id,district_id,enrolled_date,sum(total_enrolled) as total_enrolled from diksha_tpd_agg group by collection_id,district_id,enrolled_date,collection_name) as tot_enrol on a.collection_id=tot_enrol.collection_id and a.district_id=tot_enrol.district_id and a.dates=tot_enrol.enrolled_date group by a.district_id,a.dates,a.district) as res group by res.district_id,res.dates,res.day_wise,total_enrolled,district_name;"
    },
    {
        "diksha_tpd_enrolment_progress_all_course": "select res.collection_id,res.collection_name,res.dates as date,sum(res.day_wise) over (partition by res.collection_id order by res.dates asc rows between unbounded preceding and current row) as expected_enrollment,sum(res.total_enrolled) over (partition by res.collection_id order by res.dates asc rows unbounded preceding ) as net_enrollment from (select a.collection_id,a.collection_name,a.dates,sum(day_wise) as day_wise,case when sum(total_enrolled) is not null then sum(total_enrolled) else 0 end as total_enrolled from (select collection_id,district,collection_name,district_id,batch_id,generate_series(batch_start_date::date,batch_end_date::date, '1 day'::interval)::date as dates from diksha_tpd_expected_enrollment  where batch_end_date is not null ) as a join (select distinct batch_id,collection_id,district_id,expected_enrollment,(batch_end_date::date - batch_start_date::date)+1 as duration,expected_enrollment/COALESCE((batch_end_date::date - batch_start_date::date)+1,1) as day_wise from diksha_tpd_expected_enrollment  where batch_end_date is not null ) as b  on  a.batch_id = b.batch_id and a.collection_id=b.collection_id and a.district_id=b.district_id left join (select distinct collection_id,district_id,enrolled_date,sum(total_enrolled) as total_enrolled from diksha_tpd_agg group by collection_id,district_id,enrolled_date,collection_name) as tot_enrol on a.collection_id=tot_enrol.collection_id and a.district_id=tot_enrol.district_id and a.dates=tot_enrol.enrolled_date group by a.collection_id,a.dates,a.collection_name) as res group by collection_id,res.dates,res.day_wise,total_enrolled,collection_name;"
    },
    {
        "diksha_tpd_enrolment_progress_state": "select res.dates as date,sum(res.day_wise) over (order by res.dates asc rows between unbounded preceding and current row) as expected_enrollment,sum(res.total_enrolled) over (order by res.dates asc rows unbounded preceding ) as net_enrollment from (select a.dates,sum(day_wise) as day_wise,case when sum(total_enrolled) is not null then sum(total_enrolled) else 0 end as total_enrolled from (select collection_id,district,collection_name,district_id,batch_id,generate_series(batch_start_date::date,batch_end_date::date, '1 day'::interval)::date as dates from diksha_tpd_expected_enrollment  where batch_end_date is not null ) as a join (select distinct batch_id,collection_id,district_id,expected_enrollment,(batch_end_date::date - batch_start_date::date)+1 as duration,expected_enrollment/COALESCE((batch_end_date::date - batch_start_date::date)+1,1) as day_wise from diksha_tpd_expected_enrollment  where batch_end_date is not null ) as b  on  a.batch_id = b.batch_id and a.collection_id=b.collection_id and a.district_id=b.district_id left join (select distinct collection_id,district_id,enrolled_date,sum(total_enrolled) as total_enrolled from diksha_tpd_agg group by collection_id,district_id,enrolled_date,collection_name) as tot_enrol on a.collection_id=tot_enrol.collection_id and a.district_id=tot_enrol.district_id and a.dates=tot_enrol.enrolled_date group by a.dates) as res group by res.dates,res.day_wise,total_enrolled;"
    }
]